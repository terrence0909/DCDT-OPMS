version: '3.8'

services:
  # Microsoft AD in Docker (Samba4 based)
  ad-server:
    image: nowsci/samba-domain
    container_name: dcdt-ad-server
    hostname: dc01.dcdt.local
    ports:
      - "389:389"    # LDAP
      - "636:636"    # LDAPS
      - "88:88"      # Kerberos
      - "135:135"    # RPC
      - "138:138"    # NetBIOS
      - "139:139"    # NetBIOS
      - "445:445"    # SMB
      - "464:464"    # Kerberos password
      - "3268:3268"  # Global Catalog
      - "3269:3269"  # Global Catalog SSL
    environment:
      SAMBA_DOMAIN: DCDT
      SAMBA_REALM: DCDT.LOCAL
      SAMBA_HOSTNAME: dc01
      SAMBA_ADMIN_PASSWORD: Admin123!
      SAMBA_DRIVER: ad
      SAMBA_NOCOMPLEXITY: 'false'
    volumes:
      - samba-data:/var/lib/samba
      - samba-config:/etc/samba
    networks:
      - dcdt-network

  # PHP LDAP Admin for management GUI
  ldap-admin:
    image: osixia/phpldapadmin:latest
    container_name: dcdt-ldap-admin
    environment:
      PHPLDAPADMIN_LDAP_HOSTS: ad-server
      PHPLDAPADMIN_HTTPS: "false"
    ports:
      - "8080:80"
    depends_on:
      - ad-server
    networks:
      - dcdt-network

volumes:
  samba-data:
  samba-config:

networks:
  dcdt-network:
    driver: bridge
